import React, { useState, useEffect, useMemo } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line } from 'recharts';

// --- SVG Icons (replacing lucide-react) ---
const PackageIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v2"/><path d="m7 17 5 3 5-3"/><path d="M7 12v5l5 3v-5l-5-3z"/><path d="M12 22V12"/><path d="m17 17-5 3-5-3"/><path d="m17 12-5-3-5 3"/><path d="M12 12v10"/></svg>;
const AlertTriangleIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>;
const ClockIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
const CheckCircleIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>;
const ArrowUpIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>;
const ArrowDownIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>;
const CalendarIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
const BuildingIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M9 9h6v6H9z"/><path d="M9 1v2"/><path d="M15 1v2"/><path d="M9 21v2"/><path d="M15 21v2"/><path d="M21 9h2"/><path d="M21 15h2"/><path d="M1 9h2"/><path d="M1 15h2"/></svg>;


// --- Configuration (from original file) ---
const SUPABASE_CONFIG = {
    url: 'https://iugwfmnfmulgxvaxjkwv.supabase.co',
    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml1Z3dmbW5mbXVsZ3h2YXhqa3d2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI3MTU2MDIsImV4cCI6MjA2ODI5MTYwMn0.pUExanPG_BdTN11gtHg_cOubUkMOEv3n0a1mksLH_ZE',
    tableName: 'delivery_analytics',
};

const CHART_COLORS = {
    delivery: '#6366f1',
    collection: '#14b8a6',
    pending: '#f59e0b',
    completed: '#22c55e',
    urgent: '#ef4444',
    nonUrgent: '#3b82f6',
    pie: ['#6366f1', '#14b8a6', '#f97316', '#22c55e', '#ef4444', '#8b5cf6'],
};


// --- Helper Functions ---
const formatCustomerName = (str) => {
    if (!str || typeof str !== 'string') return 'Unknown';
    return str.toUpperCase();
};

const parseDate = (dateString) => {
    // This is more robust and handles ISO strings from Supabase directly
    // as well as other standard date formats.
    const date = new Date(dateString);
    return date;
};


// --- Child Components ---

const Header = () => (
    <header className="text-center mb-8">
        <h1 className="text-3xl md:text-4xl font-bold text-gray-800 tracking-tight">Delivery Performance Analytics</h1>
        <p className="mt-2 text-lg text-gray-600">Key insights into delivery operations and performance metrics</p>
        <div className="mt-6">
            <a href="aging.html" className="inline-block bg-indigo-600 text-white font-semibold px-6 py-3 rounded-lg shadow-md hover:bg-indigo-700 transition-transform transform hover:-translate-y-0.5">
                üöö Track Aging
            </a>
        </div>
    </header>
);

const Filters = ({ dateRange, setDateRange, department, setDepartment, departments }) => (
    <div className="bg-white p-4 rounded-xl shadow-md mb-8 flex flex-wrap justify-center items-center gap-4 md:gap-6">
        <div className="flex items-center gap-2">
            <CalendarIcon />
            <label htmlFor="startDate" className="font-semibold text-gray-700">From:</label>
            <input
                type="date"
                id="startDate"
                value={dateRange.start}
                onChange={(e) => setDateRange(prev => ({ ...prev, start: e.target.value }))}
                className="p-2 border border-gray-300 rounded-md bg-gray-50 focus:ring-2 focus:ring-indigo-500"
            />
        </div>
        <div className="flex items-center gap-2">
            <CalendarIcon />
            <label htmlFor="endDate" className="font-semibold text-gray-700">To:</label>
            <input
                type="date"
                id="endDate"
                value={dateRange.end}
                onChange={(e) => setDateRange(prev => ({ ...prev, end: e.target.value }))}
                className="p-2 border border-gray-300 rounded-md bg-gray-50 focus:ring-2 focus:ring-indigo-500"
            />
        </div>
        <div className="flex items-center gap-2">
            <BuildingIcon />
            <label htmlFor="departmentFilter" className="font-semibold text-gray-700">Department:</label>
            <select
                id="departmentFilter"
                value={department}
                onChange={(e) => setDepartment(e.target.value)}
                className="p-2 border border-gray-300 rounded-md bg-gray-50 focus:ring-2 focus:ring-indigo-500"
            >
                <option value="all">All Departments</option>
                {departments.map(dept => <option key={dept} value={dept}>{dept}</option>)}
            </select>
        </div>
    </div>
);

const KpiCard = ({ title, value, change, icon, iconBg, isUrgent = false }) => {
    const isPositive = change >= 0;
    const trendClass = isPositive ? 'text-green-600' : 'text-red-600';
    const TrendIcon = isPositive ? ArrowUpIcon : ArrowDownIcon;

    return (
        <div className="bg-white p-5 rounded-xl shadow-md flex items-center gap-5 transition-transform transform hover:-translate-y-1 hover:shadow-lg">
            <div className={`flex-shrink-0 w-14 h-14 rounded-full flex items-center justify-center ${iconBg}`}>
                {icon}
            </div>
            <div className="text-left">
                <p className="text-sm font-semibold text-gray-500 uppercase tracking-wider">{title}</p>
                <p className="text-3xl font-bold text-gray-800">{value.toLocaleString()}</p>
                 <div className={`text-sm font-medium mt-1 flex items-center gap-1 h-5 ${isUrgent ? 'text-gray-500' : trendClass}`}>
                    {!isUrgent && change !== null && isFinite(change) ? (
                        <>
                            <TrendIcon />
                            <span>{Math.abs(change).toFixed(1)}% vs last period</span>
                        </>
                    ) : (
                        <span>{change}</span>
                    )}
                </div>
            </div>
        </div>
    );
};

const ChartContainer = ({ title, children }) => (
    <div className="bg-white p-6 rounded-xl shadow-md">
        <div className="pb-4 mb-4 border-b border-gray-200">
            <h3 className="text-lg font-semibold text-gray-800">{title}</h3>
        </div>
        <div className="h-72 w-full">
            {children}
        </div>
    </div>
);

const DepartmentTable = ({ data }) => (
     <div className="bg-white p-6 rounded-xl shadow-md">
        <h3 className="text-xl font-semibold text-gray-800 mb-4">üè¢ Department Performance</h3>
        <div className="overflow-x-auto">
            <table className="w-full text-left">
                <thead>
                    <tr className="bg-gray-50">
                        <th className="p-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Department</th>
                        <th className="p-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Delivery</th>
                        <th className="p-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Collection</th>
                        <th className="p-4 text-xs font-semibold text-gray-600 uppercase tracking-wider">Total</th>
                    </tr>
                </thead>
                <tbody className="divide-y divide-gray-200">
                    {data.length > 0 ? data.map(d => (
                        <tr key={d.dept} className="hover:bg-gray-50">
                            <td className="p-4 font-medium text-gray-800">{d.dept}</td>
                            <td className="p-4 text-gray-600">{d.delivery.toLocaleString()}</td>
                            <td className="p-4 text-gray-600">{d.collection.toLocaleString()}</td>
                            <td className="p-4 font-bold text-gray-800">{(d.delivery + d.collection).toLocaleString()}</td>
                        </tr>
                    )) : (
                        <tr>
                            <td colSpan="4" className="text-center p-6 text-gray-500">No department data for this period.</td>
                        </tr>
                    )}
                </tbody>
            </table>
        </div>
    </div>
);

// --- Main App Component ---
export default function App() {
    const [allData, setAllData] = useState([]);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);
    const [departments, setDepartments] = useState([]);
    
    const [dateRange, setDateRange] = useState(() => {
        const today = new Date();
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(today.getDate() - 30);
        return {
            start: thirtyDaysAgo.toISOString().split('T')[0],
            end: today.toISOString().split('T')[0],
        };
    });
    const [selectedDept, setSelectedDept] = useState('all');

    // --- Data Fetching ---
    useEffect(() => {
        const fetchData = async () => {
            setLoading(true);
            setError(null);
            try {
                const response = await fetch(`${SUPABASE_CONFIG.url}/rest/v1/${SUPABASE_CONFIG.tableName}?select=*&order=created_at.desc`, {
                    headers: {
                        'apikey': SUPABASE_CONFIG.key,
                        'Authorization': `Bearer ${SUPABASE_CONFIG.key}`,
                    }
                });
                if (!response.ok) throw new Error(`Database error: ${response.statusText}`);
                
                const rawData = await response.json();
                if (!rawData || rawData.length === 0) throw new Error('No data found in the database.');

                const processedData = rawData.map(d => ({
                    ...d,
                    customer: formatCustomerName(d.customer),
                    dept: d.dept || 'N/A',
                    order_date: d.order_received ? parseDate(d.order_received) : null,
                    is_pending: d.status ? d.status.toLowerCase().includes('pending') : false,
                    is_urgent: d.urgent ? d.urgent.toLowerCase() === 'yes' : false,
                    type: d.type ? (d.type.toLowerCase().includes('delivery') ? 'Delivery' : 'Collection') : 'Unknown'
                })).filter(d => d.order_date instanceof Date && !isNaN(d.order_date) && d.customer);
                
                setAllData(processedData);
                const uniqueDepts = [...new Set(processedData.map(d => d.dept))].filter(d => d && d !== 'N/A').sort();
                setDepartments(uniqueDepts);

            } catch (err) {
                setError(err.message);
                console.error('Data loading failed:', err);
            } finally {
                setLoading(false);
            }
        };
        fetchData();
    }, []);

    // --- Memoized Data Processing ---
    const filteredData = useMemo(() => {
        if (!dateRange.start || !dateRange.end) return [];
        
        const startDate = new Date(dateRange.start);
        startDate.setHours(0, 0, 0, 0);
        const endDate = new Date(dateRange.end);
        endDate.setHours(23, 59, 59, 999);

        return allData.filter(d => {
            const dateMatch = d.order_date >= startDate && d.order_date <= endDate;
            const deptMatch = selectedDept === 'all' || d.dept === selectedDept;
            return dateMatch && deptMatch;
        });
    }, [allData, dateRange, selectedDept]);
    
    const previousPeriodData = useMemo(() => {
        const start = new Date(dateRange.start);
        const end = new Date(dateRange.end);
        const diff = end.getTime() - start.getTime();
        
        const prevEndDate = new Date(start.getTime() - 1);
        const prevStartDate = new Date(prevEndDate.getTime() - diff);

        return allData.filter(d => {
            const dateMatch = d.order_date >= prevStartDate && d.order_date <= prevEndDate;
            const deptMatch = selectedDept === 'all' || d.dept === selectedDept;
            return dateMatch && deptMatch;
        });
    }, [allData, dateRange, selectedDept]);

    const kpiData = useMemo(() => {
        const calcStats = (data) => ({
            totalOrders: data.length,
            ticketsDone: data.filter(d => !d.is_pending).length,
            urgentOrders: data.filter(d => d.is_urgent).length,
        });

        const current = calcStats(filteredData);
        const previous = calcStats(previousPeriodData);
        
        const calcChange = (currentVal, previousVal) => {
            if (previousVal === 0) return currentVal > 0 ? Infinity : 0;
            return ((currentVal - previousVal) / previousVal) * 100;
        };
        
        return {
            totalOrders: current.totalOrders,
            totalOrdersChange: calcChange(current.totalOrders, previous.totalOrders),
            ticketsDone: current.ticketsDone,
            ticketsDoneChange: calcChange(current.ticketsDone, previous.ticketsDone),
            pendingDeliveries: current.totalOrders - current.ticketsDone,
            urgentOrders: current.urgentOrders,
            urgentOrdersChange: `vs ${previous.urgentOrders} last period`,
        };
    }, [filteredData, previousPeriodData]);

    const chartAndTableData = useMemo(() => {
        const data = filteredData;
        
        const serviceTypeCounts = data.reduce((acc, d) => {
            if (d.type !== 'Unknown') acc[d.type] = (acc[d.type] || 0) + 1;
            return acc;
        }, { 'Delivery': 0, 'Collection': 0 });

        const urgentCounts = data.reduce((acc, d) => {
            if (d.is_urgent) acc.urgent++; else acc.nonUrgent++;
            return acc;
        }, { urgent: 0, nonUrgent: 0 });

        const departmentPerformance = data.reduce((acc, d) => {
            if (d.dept && d.dept !== 'N/A') {
                if (!acc[d.dept]) acc[d.dept] = { dept: d.dept, delivery: 0, collection: 0 };
                if (d.type === 'Delivery') acc[d.dept].delivery++;
                else if (d.type === 'Collection') acc[d.dept].collection++;
            }
            return acc;
        }, {});
        
        const trendData = data.reduce((acc, d) => {
            const dateString = d.order_date.toISOString().split('T')[0];
            if (!acc[dateString]) acc[dateString] = { date: dateString, total: 0, completed: 0, pending: 0 };
            acc[dateString].total++;
            if (d.is_pending) acc[dateString].pending++;
            else acc[dateString].completed++;
            return acc;
        }, {});
        
        const topCustomerData = Object.entries(data.reduce((acc, d) => {
                if(d.type === 'Delivery' || d.type === 'Collection') {
                    if (!acc[d.customer]) acc[d.customer] = { customer: d.customer, Delivery: 0, Collection: 0 };
                    acc[d.customer][d.type]++;
                }
                return acc;
            }, {}))
            .map(([, value]) => value)
            .sort((a,b) => (b.Delivery + b.Collection) - (a.Delivery + a.Collection))
            .slice(0, 5);

        const deliveryByDay = data.reduce((acc, d) => {
            const day = d.order_date.toLocaleDateString('en-US', { weekday: 'short' });
            if (!acc[day]) acc[day] = { name: day, Delivery: 0, Collection: 0 };
            if(d.type === 'Delivery' || d.type === 'Collection') acc[day][d.type]++;
            return acc;
        }, {});
        const dayOrder = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        
        const urgentByDept = Object.entries(data
            .filter(d => d.is_urgent && d.dept && d.dept !== 'N/A')
            .reduce((acc, d) => {
                acc[d.dept] = (acc[d.dept] || 0) + 1;
                return acc;
            }, {}))
            .map(([name, value]) => ({ name, value }))
            .sort((a,b) => b.value - a.value);

        return {
            serviceTypePie: [{ name: 'Delivery', value: serviceTypeCounts.Delivery }, { name: 'Collection', value: serviceTypeCounts.Collection }],
            urgentPie: [{ name: 'Urgent', value: urgentCounts.urgent }, { name: 'Non-Urgent', value: urgentCounts.nonUrgent }],
            departmentTable: Object.values(departmentPerformance).sort((a, b) => (b.delivery + b.collection) - (a.delivery + a.collection)),
            trendChart: Object.values(trendData).sort((a, b) => new Date(a.date) - new Date(b.date)),
            topCustomerChart: topCustomerData,
            deliveryBarChart: dayOrder.map(day => deliveryByDay[day] || { name: day, Delivery: 0, Collection: 0 }),
            ordersByDeptChart: Object.values(departmentPerformance).sort((a,b) => (b.delivery + b.collection) - (a.delivery + a.collection)),
            urgentByDeptChart: urgentByDept,
        };
    }, [filteredData]);

    const RADIAN = Math.PI / 180;
    const renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent, index }) => {
        const radius = innerRadius + (outerRadius - innerRadius) * 0.5;
        const x = cx + radius * Math.cos(-midAngle * RADIAN);
        const y = cy + radius * Math.sin(-midAngle * RADIAN);

        if (percent * 100 < 5) return null; // Don't render label if slice is too small

        return (
            <text x={x} y={y} fill="white" textAnchor={x > cx ? 'start' : 'end'} dominantBaseline="central">
            {`${(percent * 100).toFixed(0)}%`}
            </text>
        );
    };


    // --- Render Logic ---
    if (loading) {
        return <div className="flex items-center justify-center min-h-screen bg-gray-50 text-gray-600">Loading dashboard...</div>;
    }
    if (error) {
        return <div className="flex items-center justify-center min-h-screen bg-red-50 text-red-700">Error: {error}</div>;
    }

    return (
        <div className="bg-gray-50 min-h-screen p-4 sm:p-6 md:p-8">
            <div className="max-w-7xl mx-auto">
                <Header />
                <Filters 
                    dateRange={dateRange}
                    setDateRange={setDateRange}
                    department={selectedDept}
                    setDepartment={setSelectedDept}
                    departments={departments}
                />
                
                <main>
                    {/* KPI Grid */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <KpiCard title="Total Orders" value={kpiData.totalOrders} change={kpiData.totalOrdersChange} icon={<PackageIcon />} iconBg="bg-indigo-500" />
                        <KpiCard title="Urgent Orders" value={kpiData.urgentOrders} change={kpiData.urgentOrdersChange} icon={<AlertTriangleIcon />} iconBg="bg-red-500" isUrgent={true} />
                        <KpiCard title="Pending Orders" value={kpiData.pendingDeliveries} change={null} icon={<ClockIcon />} iconBg="bg-amber-500" />
                        <KpiCard title="Tickets Done" value={kpiData.ticketsDone} change={kpiData.ticketsDoneChange} icon={<CheckCircleIcon />} iconBg="bg-green-500" />
                    </div>

                    {/* Charts Grid */}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="lg:col-span-2">
                            <ChartContainer title="Order & Status Trend Over Time">
                                <ResponsiveContainer>
                                    <LineChart data={chartAndTableData.trendChart}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis dataKey="date" />
                                        <YAxis />
                                        <Tooltip />
                                        <Legend />
                                        <Line type="monotone" dataKey="total" stroke={CHART_COLORS.delivery} name="Total" strokeWidth={2} />
                                        <Line type="monotone" dataKey="completed" stroke={CHART_COLORS.completed} name="Completed" />
                                        <Line type="monotone" dataKey="pending" stroke={CHART_COLORS.pending} name="Pending" />
                                    </LineChart>
                                </ResponsiveContainer>
                            </ChartContainer>
                        </div>
                        
                        <ChartContainer title="Service Type Distribution">
                            <ResponsiveContainer>
                                <PieChart>
                                    <Pie 
                                        data={chartAndTableData.serviceTypePie} 
                                        dataKey="value" 
                                        nameKey="name" 
                                        cx="50%" 
                                        cy="50%" 
                                        outerRadius={80} 
                                        labelLine={false}
                                        label={renderCustomizedLabel}
                                    >
                                        <Cell fill={CHART_COLORS.delivery} />
                                        <Cell fill={CHART_COLORS.collection} />
                                    </Pie>
                                    <Tooltip />
                                    <Legend />
                                </PieChart>
                            </ResponsiveContainer>
                        </ChartContainer>

                        <ChartContainer title="Urgent vs. Non-Urgent">
                             <ResponsiveContainer>
                                <PieChart>
                                    <Pie 
                                        data={chartAndTableData.urgentPie} 
                                        dataKey="value" 
                                        nameKey="name" 
                                        cx="50%" 
                                        cy="50%" 
                                        outerRadius={80} 
                                        labelLine={false}
                                        label={renderCustomizedLabel}
                                    >
                                        <Cell fill={CHART_COLORS.urgent} />
                                        <Cell fill={CHART_COLORS.nonUrgent} />
                                    </Pie>
                                    <Tooltip />
                                    <Legend />
                                </PieChart>
                            </ResponsiveContainer>
                        </ChartContainer>
                        
                        <ChartContainer title="Top 5 Customers by Service Type">
                             <ResponsiveContainer>
                                <BarChart data={chartAndTableData.topCustomerChart} layout="vertical">
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis type="number" />
                                    <YAxis type="category" dataKey="customer" width={150} />
                                    <Tooltip />
                                    <Legend />
                                    <Bar dataKey="Delivery" stackId="a" fill={CHART_COLORS.delivery} />
                                    <Bar dataKey="Collection" stackId="a" fill={CHART_COLORS.collection} />
                                </BarChart>
                            </ResponsiveContainer>
                        </ChartContainer>

                        <ChartContainer title="Orders by Department">
                             <ResponsiveContainer>
                                <BarChart data={chartAndTableData.ordersByDeptChart} layout="vertical">
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis type="number" />
                                    <YAxis type="category" dataKey="dept" width={150} />
                                    <Tooltip />
                                    <Legend />
                                    <Bar dataKey="delivery" stackId="a" fill={CHART_COLORS.delivery} name="Delivery" />
                                    <Bar dataKey="collection" stackId="a" fill={CHART_COLORS.collection} name="Collection" />
                                </BarChart>
                            </ResponsiveContainer>
                        </ChartContainer>

                        <ChartContainer title="Delivery vs. Collection by Day">
                             <ResponsiveContainer>
                                <BarChart data={chartAndTableData.deliveryBarChart}>
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis dataKey="name" />
                                    <YAxis />
                                    <Tooltip />
                                    <Legend />
                                    <Bar dataKey="Delivery" stackId="a" fill={CHART_COLORS.delivery} />
                                    <Bar dataKey="Collection" stackId="a" fill={CHART_COLORS.collection} />
                                </BarChart>
                            </ResponsiveContainer>
                        </ChartContainer>

                        <ChartContainer title="Urgent Count by Department">
                             <ResponsiveContainer>
                                <BarChart data={chartAndTableData.urgentByDeptChart} layout="vertical">
                                    <CartesianGrid strokeDasharray="3 3" />
                                    <XAxis type="number" />
                                    <YAxis type="category" dataKey="name" width={150} />
                                    <Tooltip />
                                    <Bar dataKey="value" fill={CHART_COLORS.urgent} name="Urgent Orders" />
                                </BarChart>
                            </ResponsiveContainer>
                        </ChartContainer>
                        
                        <div className="lg:col-span-2 mt-2">
                           <DepartmentTable data={chartAndTableData.departmentTable} />
                        </div>
                    </div>
                </main>
            </div>
        </div>
    );
}
